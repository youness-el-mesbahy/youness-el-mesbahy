---
import Input from "../../ui/Input.astro";
import TextArea from "../../ui/TextArea.astro";
import {Copy, Send, X} from "@lucide/astro";
import Button from "../../ui/Button.astro";
---

<div id="contact-form-modal-overlay"
     class="fixed invisible opacity-0 duration-400  w-screen  h-screen left-0 top-0 bg-gray-500/24">

    <div id="contact-form-modal"
         class=" w-[calc(100vw-30px)]   border border-oregon-blue-700 pt-8 rounded-t-2xl   h-[85vh] fixed bottom-0 bg-milk left-1/2 -translate-x-1/2 translate-y-full duration-400">
        <form id="contact-form" class="  py-6 px-16 mb-20 rounded-sm  mx-auto w-1/2">
            <div class="flex justify-between items-center">
                <h3 class="relative  w-fit text-xl font-semibold after:content-[''] after:absolute after:left-0 after:-bottom-2 after:w-full after:h-[2px] after:bg-primary">
                    Contact Me
                </h3>
                <button type="button" id="modal-close-btn" class="p-2 text-carbon-1400 hover:bg-carbon-100 duration-300 rounded-sm">
                    <X size="18px"/>
                </button>
            </div>
            <div class="mt-12 grid grid-cols-2 items-center  gap-x-5 space-y-5">

                <Input label="Name" placeholder="Your Name" id="name"/>
                <Input label="Email" placeholder="Your Email" id="email"/>
                <div class="col-span-2">

                    <TextArea label="Message" placeholder="Your Message" id="message"/>
                </div>
                <!--<div class="flex gap-5 mt-4 col-">-->
                <Button id="contact-form-cancel-btn" variant="secondary">
                    Cancel
                </Button>
                <Button type="submit">
                    <Send size="20px"/>
                    &nbsp;Send
                </Button>
                <!--</div>-->
            </div>
        </form>
    </div>
</div>

<script>
    const btnCloseModal = document.getElementById("modal-close-btn")
    const btnCloseModal2 = document.getElementById("contact-form-cancel-btn");
    [btnCloseModal, btnCloseModal2].forEach(btn => {
        btn?.addEventListener("click", () => {
            const modalContactForm = document.getElementById("contact-form-modal")
            modalContactForm?.classList.add("translate-y-full", "invisible", "opacity-0")
            const overlayContactFormModal = document.getElementById("contact-form-modal-overlay")
            overlayContactFormModal?.classList.add("invisible", "opacity-0")
        })
    })

</script>

<script>
    const btnOpenModal = document.getElementById("btn-contact-me");
    const btnOpenModal2 = document.getElementById("btn-contact-me-2");

    [btnOpenModal, btnOpenModal2].forEach(btn => {
        if (btn)
            btn?.addEventListener("click", () => {
                const modalContactForm = document.getElementById("contact-form-modal")
                modalContactForm?.classList.remove("translate-y-full", "invisible", "opacity-0")
                const overlayContactFormModal = document.getElementById("contact-form-modal-overlay")
                overlayContactFormModal?.classList.remove("invisible", "opacity-0")
            })
    })

</script>


<script>
    const form = document.getElementById('contact-form');
    const submitBtn = form.querySelector('button[type="submit"]');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        formData.append("access_key", "e5254867-504d-440b-9af1-bf4f4c4c73a3");

        const originalText = submitBtn.textContent;

        submitBtn.textContent = "Sending...";
        submitBtn.disabled = true;

        try {
            const response = await fetch("https://api.web3forms.com/submit", {
                method: "POST",
                body: formData
            });

            const data = await response.json();

            submitBtn.classList.remove("bg-primary");
            if (response.ok) {
                form.reset();
                submitBtn.textContent = "Success!";
                submitBtn.classList.add("bg-[#5CB85C]");
            } else {
                submitBtn.textContent = "Failed!";
                submitBtn.classList.add("bg-[#D9534F]");
            }

        } finally {
            setTimeout(() => {
                submitBtn.classList.remove("bg-[#D9534F]");
                submitBtn.classList.remove("bg-[#5CB85C]");
                submitBtn.classList.add("bg-primary");
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 1500)
            // submitBtn.textContent = originalText;
        }
    });
</script>
