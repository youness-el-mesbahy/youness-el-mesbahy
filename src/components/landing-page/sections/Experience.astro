---
import Section from "../Section.astro";
import {getCollection} from "astro:content";
import ExperienceEntry from "./Experience/ExperienceEntry.astro";
const education = await getCollection("education");
---

<Section
        id="education"
        title="2.&nbsp;Education"
        subtitle="Lorem IpsumÂ is simply dummy text of the printing and typesetting"
>
    <div class="flex mt-20 justify-center timeline_component ">

            <div class="overlay-fade-top"></div>
            <div class="overlay-fade-bottom"></div>



        <div class=" relative space-y-24" id="timeline-container">
            <div class="absolute top-[-5rem] left-[0.375rem] w-[0.1875rem] h-[calc(100%+10rem)] bg-gray-500 overflow-hidden" id="timeline-bg">
                <div class="bg-gradient w-[0.1875rem] h-0" id="gradient-line"></div>
            </div>

            {education.map((entry) => (
                    <div>
                        <ExperienceEntry
                                dateRange={`${entry.data.startYear} - ${entry.data.endYear ?? "Present"}`}
                                title={entry.data.heading}
                                company={entry.data.institution}
                                location={entry.data.location}
                                heading={entry.data.title}
                        >
                            {entry.data.descriptionBlocks.map((block) => (
                                    <ul class="list-disc pl-5 space-y-1">
                                        {block.items.map((item) => (
                                                <li>{item}</li>
                                        ))}
                                    </ul>
                            ))}
                        </ExperienceEntry>
                    </div>
            ))}
        </div>
    </div>
</Section>



<script>
    function updateGradientLine() {
        const timelineBg = document.getElementById('timeline-bg');
        const gradientLine = document.getElementById('gradient-line');

        if (!timelineBg || !gradientLine) return;

        const rect = timelineBg.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const intersectionY = viewportHeight * 0.4;

        let revealAmount = intersectionY - rect.top;
        revealAmount = Math.max(0, Math.min(revealAmount, rect.height));

        gradientLine.style.height = revealAmount + 'px';
    }

    // Use requestAnimationFrame for smooth updates
    let ticking = false;
    function onScroll() {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                updateGradientLine();
                ticking = false;
            });
            ticking = true;
        }
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', updateGradientLine, { passive: true });
    document.addEventListener('DOMContentLoaded', updateGradientLine);
</script>